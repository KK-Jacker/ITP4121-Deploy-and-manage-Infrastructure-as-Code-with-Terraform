"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MainStack = void 0;
const cdktf_1 = require("cdktf");
const provider_azurerm_1 = require("@cdktf/provider-azurerm");
const azure_ad_1 = require("./azure/azure_ad");
const application_insight_1 = require("./azure/application_insight");
const mysql_server_1 = require("./azure/mysql_server");
const mysql_db_1 = require("./azure/mysql_db");
const mysql_db_firewall_1 = require("./azure/mysql_db_firewall");
const blob_1 = require("./azure/blob");
const chatbot_1 = require("./azure/chatbot");
const container_registry_1 = require("./azure/container_registry");
const cognitive_service_1 = require("./azure/cognitive_service");
const key_vault_1 = require("./azure/key_vault");
const virtual_network_1 = require("./azure/virtual_network");
const kubernetes_1 = require("./azure/kubernetes");
const path_1 = require("path");
const dotenv_1 = require("dotenv");
const fs = require("fs");
const provider_null_1 = require("@cdktf/provider-null");
const local_1 = require("./.gen/providers/local");
class MainStack extends cdktf_1.TerraformStack {
    constructor(scope, name, props) {
        super(scope, name);
        (0, dotenv_1.config)({ path: (0, path_1.resolve)(__dirname, `./${props.env}.env`) });
        process.env.ENV = props.env;
        process.env.RESOURCE_GROUP_NAME = process.env.RESOURCE_GROUP_NAME + props.env;
        console.log("Resource Group:" + process.env.RESOURCE_GROUP_NAME);
        if (fs.existsSync((0, path_1.resolve)(__dirname, `./secrets.env`))) {
            console.log("Overrides with secrets.env.template");
            const envConfig = (0, dotenv_1.parse)(fs.readFileSync((0, path_1.resolve)(__dirname, `./secrets.env`)));
            for (const k in envConfig) {
                process.env[k] = envConfig[k];
            }
        }
        new provider_azurerm_1.AzurermProvider(this, "Azure provider", {
            features: [{}],
            skipProviderRegistration: false,
        });
        const resourceGroup = new provider_azurerm_1.ResourceGroup(this, "Resource group", {
            name: process.env.RESOURCE_GROUP_NAME,
            location: process.env.LOCATION,
        });
        const azureAdConstruct = new azure_ad_1.AzureAdConstruct(this, "Azure AD");
        const blobStorageConstruct = new blob_1.BlobStorageConstruct(this, "Blob", { resourceGroup });
        const mySQLServerConstruct = new mysql_server_1.MySQLServerConstruct(this, "MySQL server", { resourceGroup });
        new mysql_db_1.MySQLDatabaseConstruct(this, "MySQL database", {
            resourceGroup,
            mysqlServer: mySQLServerConstruct.mysqlServer,
        });
        new mysql_db_firewall_1.MySQLFirewallConstruct(this, "MySQL firewall", {
            resourceGroup,
            mysqlServer: mySQLServerConstruct.mysqlServer,
        });
        const virtualNetworkConstruct = new virtual_network_1.VirtualNetworkConstruct(this, "Virtual Network", {
            resourceGroup,
        });
        const containerRegistrySConstruct = new container_registry_1.ContainerRegistrySConstruct(this, "container registry", {
            resourceGroup,
            azureadConstruct: azureAdConstruct,
        });
        const applicationInsightsConstruct = new application_insight_1.ApplicationInsightsConstruct(this, "Application insights", {
            resourceGroup,
        });
        const cognitiveServiceConstruct = new cognitive_service_1.CognitiveServiceConstruct(this, "Cognitive Service", {
            resourceGroup
        });
        const chatBotConstruct = new chatbot_1.ChatBotConstruct(this, "Chat Bot", {
            resourceGroup
        });
        const keyVaultConstruct = new key_vault_1.KeyVaultConstruct(this, "KeyVault", {
            resourceGroup,
            storageAccount: blobStorageConstruct.storageAccount,
            servicePrincipalObjectId: azureAdConstruct.servicePrincipalObjectId,
            applicationInsightsKey: applicationInsightsConstruct.applicationInsights.instrumentationKey,
            webChatBotSecret: chatBotConstruct.webChatBotSecret,
            cognitiveServiceConstruct
        });
        const kubernetesClusterSConstruct = new kubernetes_1.KubernetesClusterSConstruct(this, "Kubernetes", {
            resourceGroup,
            virtualNetwork: virtualNetworkConstruct,
            azureAdConstruct: azureAdConstruct,
            containerRegistry: containerRegistrySConstruct,
            keyVaultConstruct: keyVaultConstruct,
            mysqlServerConstruct: mySQLServerConstruct,
        });
        const get_k8s_exposed_ip = new provider_null_1.Resource(this, "get kubectl exposed ip", {
            triggers: {},
            dependsOn: [kubernetesClusterSConstruct.kubectl],
        });
        get_k8s_exposed_ip.addOverride("provisioner.local-exec.command", `sleep 30 && kubectl get service -l app=web -o json | jq -r .items[].status.loadBalancer.ingress[].ip > k8sexposedip.txt`);
        const k8sip = new local_1.DataLocalFile(this, "hash_content", {
            filename: "k8sexposedip.txt",
            dependsOn: [get_k8s_exposed_ip],
        });
        const k8sipcontent = k8sip.content;
        new cdktf_1.TerraformOutput(this, "Service Principal App Id", { value: azureAdConstruct.servicePrincipalAppId, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Service Principal Password", { value: azureAdConstruct.servicePrincipalPassword, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Service Principal Tenant Id", { value: azureAdConstruct.servicePrincipalTenantId, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Container Registry Admin Username", { value: containerRegistrySConstruct.containerRegistry.adminUsername, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Container Registry Admin Password", { value: containerRegistrySConstruct.containerRegistry.adminPassword, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Container Registry Identity", { value: containerRegistrySConstruct.containerRegistry.identity, sensitive: true });
        new cdktf_1.TerraformOutput(this, "Key Vault Uri", { value: keyVaultConstruct.keyVault.vaultUri, sensitive: true });
        new cdktf_1.TerraformOutput(this, "K8s LoadBalancer IP", { value: k8sipcontent, sensitive: true });
        new cdktf_1.TerraformOutput(this, "MySQL Server Hostname", { value: mySQLServerConstruct.mysqlServer.fqdn, sensitive: true });
        new cdktf_1.TerraformOutput(this, "MySQL Server Identity", { value: mySQLServerConstruct.mysqlServer.identity, sensitive: true });
        new cdktf_1.TerraformOutput(this, "MySQL Server Username", { value: mySQLServerConstruct.mysqlServer.administratorLogin, sensitive: true });
        new cdktf_1.TerraformOutput(this, "MySQL Server Password", { value: mySQLServerConstruct.mysqlServer.administratorLoginPassword, sensitive: true });
        const get_image_var = new provider_null_1.Resource(this, "get docker image name", {
            triggers: {},
            dependsOn: [kubernetesClusterSConstruct.kubernetesCluster],
        });
        get_image_var.addOverride("provisioner.local-exec.command", `echo -n $(git symbolic-ref --short HEAD) > branch.txt && echo -n $(git rev-parse --short HEAD) > hash.txt`);
        const hash_content = new local_1.DataLocalFile(this, "hash_content_main", {
            filename: "hash.txt",
            dependsOn: [get_image_var],
        });
        const branch_content = new local_1.DataLocalFile(this, "branch_content_main", {
            filename: "branch.txt",
            dependsOn: [get_image_var],
        });
        const dockerimagename = containerRegistrySConstruct.containerRegistry.loginServer + "/" + process.env.PROJECT_NAME + "-" + branch_content.content + ":" + hash_content.content;
        new cdktf_1.TerraformOutput(this, "Docker Image Name", { value: dockerimagename, sensitive: true });
        new cdktf_1.TerraformOutput(this, "resource group name", { value: resourceGroup.name, sensitive: true });
        new cdktf_1.TerraformOutput(this, "kubernetes cluster name", { value: kubernetesClusterSConstruct.kubernetesCluster.name, sensitive: true });
    }
}
exports.MainStack = MainStack;
const app = new cdktf_1.App();
new MainStack(app, "ITP4121-Project", { env: "dev" });
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaUNBQTJEO0FBQzNELDhEQUF1RTtBQUN2RSwrQ0FBa0Q7QUFDbEQscUVBQXlFO0FBQ3pFLHVEQUEwRDtBQUMxRCwrQ0FBd0Q7QUFDeEQsaUVBQWlFO0FBQ2pFLHVDQUFrRDtBQUNsRCw2Q0FBaUQ7QUFDakQsbUVBQXVFO0FBQ3ZFLGlFQUFvRTtBQUNwRSxpREFBb0Q7QUFDcEQsNkRBQWdFO0FBQ2hFLG1EQUErRDtBQUMvRCwrQkFBNkI7QUFDN0IsbUNBQXFDO0FBQ3JDLHlCQUF5QjtBQUN6Qix3REFBOEM7QUFDOUMsa0RBQXFEO0FBUXJELE1BQWEsU0FBVSxTQUFRLHNCQUFjO0lBQ3pDLFlBQVksS0FBZ0IsRUFBRSxJQUFZLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUVuQixJQUFBLGVBQU0sRUFBQyxFQUFDLElBQUksRUFBRSxJQUFBLGNBQU8sRUFBQyxTQUFTLEVBQUUsS0FBSyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDekQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUM1QixPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUM5RSxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUVqRSxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBQSxjQUFPLEVBQUMsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDLEVBQUU7WUFDcEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1lBQ25ELE1B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QUFLLEVBQUUsMkJBQTJCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUMsQ0FDL0UsQ0FBQztJQUdOLENBQUM7Q0FDSjtBQWpORCw4QkFpTkM7QUFFRCxNQUFNLEdBQUcsR0FBRyxJQUFJLFdBQUcsRUFBRSxDQUFDO0FBQ3RCLElBQUksU0FBUyxDQUFDLEdBQUcsRUFBRSxpQkFBaUIsRUFBRSxFQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO0FBQ3BELEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29uc3RydWN0fSBmcm9tIFwiY29uc3RydWN0c1wiO1xuaW1wb3J0IHtBcHAsIFRlcnJhZm9ybU91dHB1dCwgVGVycmFmb3JtU3RhY2t9IGZyb20gXCJjZGt0ZlwiO1xuaW1wb3J0IHtBenVyZXJtUHJvdmlkZXIsIFJlc291cmNlR3JvdXB9IGZyb20gXCJAY2RrdGYvcHJvdmlkZXItYXp1cmVybVwiO1xuaW1wb3J0IHtBenVyZUFkQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS9henVyZV9hZFwiO1xuaW1wb3J0IHtBcHBsaWNhdGlvbkluc2lnaHRzQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS9hcHBsaWNhdGlvbl9pbnNpZ2h0XCI7XG5pbXBvcnQge015U1FMU2VydmVyQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS9teXNxbF9zZXJ2ZXJcIjtcbmltcG9ydCB7TXlTUUxEYXRhYmFzZUNvbnN0cnVjdH0gZnJvbSBcIi4vYXp1cmUvbXlzcWxfZGJcIjtcbmltcG9ydCB7TXlTUUxGaXJld2FsbENvbnN0cnVjdH0gZnJvbSBcIi4vYXp1cmUvbXlzcWxfZGJfZmlyZXdhbGxcIjtcbmltcG9ydCB7QmxvYlN0b3JhZ2VDb25zdHJ1Y3R9IGZyb20gXCIuL2F6dXJlL2Jsb2JcIjtcbmltcG9ydCB7Q2hhdEJvdENvbnN0cnVjdH0gZnJvbSBcIi4vYXp1cmUvY2hhdGJvdFwiO1xuaW1wb3J0IHtDb250YWluZXJSZWdpc3RyeVNDb25zdHJ1Y3R9IGZyb20gXCIuL2F6dXJlL2NvbnRhaW5lcl9yZWdpc3RyeVwiO1xuaW1wb3J0IHtDb2duaXRpdmVTZXJ2aWNlQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS9jb2duaXRpdmVfc2VydmljZVwiO1xuaW1wb3J0IHtLZXlWYXVsdENvbnN0cnVjdH0gZnJvbSBcIi4vYXp1cmUva2V5X3ZhdWx0XCI7XG5pbXBvcnQge1ZpcnR1YWxOZXR3b3JrQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS92aXJ0dWFsX25ldHdvcmtcIjtcbmltcG9ydCB7S3ViZXJuZXRlc0NsdXN0ZXJTQ29uc3RydWN0fSBmcm9tIFwiLi9henVyZS9rdWJlcm5ldGVzXCI7XG5pbXBvcnQge3Jlc29sdmV9IGZyb20gXCJwYXRoXCI7XG5pbXBvcnQge2NvbmZpZywgcGFyc2V9IGZyb20gXCJkb3RlbnZcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHtSZXNvdXJjZX0gZnJvbSBcIkBjZGt0Zi9wcm92aWRlci1udWxsXCI7XG5pbXBvcnQge0RhdGFMb2NhbEZpbGV9IGZyb20gXCIuLy5nZW4vcHJvdmlkZXJzL2xvY2FsXCI7XG5cblxuXG5pbnRlcmZhY2UgTWFpblN0YWNrUHJvcHMge1xuICAgIGVudjogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgTWFpblN0YWNrIGV4dGVuZHMgVGVycmFmb3JtU3RhY2sge1xuICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIG5hbWU6IHN0cmluZywgcHJvcHM6IE1haW5TdGFja1Byb3BzKSB7XG4gICAgICAgIHN1cGVyKHNjb3BlLCBuYW1lKTtcblxuICAgICAgICBjb25maWcoe3BhdGg6IHJlc29sdmUoX19kaXJuYW1lLCBgLi8ke3Byb3BzLmVudn0uZW52YCl9KTtcbiAgICAgICAgcHJvY2Vzcy5lbnYuRU5WID0gcHJvcHMuZW52O1xuICAgICAgICBwcm9jZXNzLmVudi5SRVNPVVJDRV9HUk9VUF9OQU1FID0gcHJvY2Vzcy5lbnYuUkVTT1VSQ0VfR1JPVVBfTkFNRSArIHByb3BzLmVudjtcbiAgICAgICAgY29uc29sZS5sb2coXCJSZXNvdXJjZSBHcm91cDpcIiArIHByb2Nlc3MuZW52LlJFU09VUkNFX0dST1VQX05BTUUpO1xuXG4gICAgICAgIGlmIChmcy5leGlzdHNTeW5jKHJlc29sdmUoX19kaXJuYW1lLCBgLi9zZWNyZXRzLmVudmApKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPdmVycmlkZXMgd2l0aCBzZWNyZXRzLmVudi50ZW1wbGF0ZVwiKTtcbiAgICAgICAgICAgIGNvbnN0IGVudkNvbmZpZyA9IHBhcnNlKGZzLnJlYWRGaWxlU3luYyhyZXNvbHZlKF9fZGlybmFtZSwgYC4vc2VjcmV0cy5lbnZgKSkpXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGsgaW4gZW52Q29uZmlnKSB7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnZba10gPSBlbnZDb25maWdba11cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG5ldyBBenVyZXJtUHJvdmlkZXIodGhpcywgXCJBenVyZSBwcm92aWRlclwiLCB7XG4gICAgICAgICAgICBmZWF0dXJlczogW3t9XSxcbiAgICAgICAgICAgIHNraXBQcm92aWRlclJlZ2lzdHJhdGlvbjogZmFsc2UsXG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgY29uc3QgcmVzb3VyY2VHcm91cCA9IG5ldyBSZXNvdXJjZUdyb3VwKHRoaXMsIFwiUmVzb3VyY2UgZ3JvdXBcIiwge1xuICAgICAgICAgICAgbmFtZTogcHJvY2Vzcy5lbnYuUkVTT1VSQ0VfR1JPVVBfTkFNRSEsXG4gICAgICAgICAgICBsb2NhdGlvbjogcHJvY2Vzcy5lbnYuTE9DQVRJT04hLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBhenVyZUFkQ29uc3RydWN0ID0gbmV3IEF6dXJlQWRDb25zdHJ1Y3QodGhpcywgXCJBenVyZSBBRFwiKTtcblxuICAgICAgICBjb25zdCBibG9iU3RvcmFnZUNvbnN0cnVjdCA9IG5ldyBCbG9iU3RvcmFnZUNvbnN0cnVjdCh0aGlzLCBcIkJsb2JcIiwge3Jlc291cmNlR3JvdXB9KTtcblxuICAgICAgICBjb25zdCBteVNRTFNlcnZlckNvbnN0cnVjdCA9IG5ldyBNeVNRTFNlcnZlckNvbnN0cnVjdCh0aGlzLCBcIk15U1FMIHNlcnZlclwiLCB7cmVzb3VyY2VHcm91cH0pO1xuXG4gICAgICAgIG5ldyBNeVNRTERhdGFiYXNlQ29uc3RydWN0KHRoaXMsIFwiTXlTUUwgZGF0YWJhc2VcIiwge1xuICAgICAgICAgICAgcmVzb3VyY2VHcm91cCxcbiAgICAgICAgICAgIG15c3FsU2VydmVyOiBteVNRTFNlcnZlckNvbnN0cnVjdC5teXNxbFNlcnZlcixcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IE15U1FMRmlyZXdhbGxDb25zdHJ1Y3QodGhpcywgXCJNeVNRTCBmaXJld2FsbFwiLCB7XG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwLFxuICAgICAgICAgICAgbXlzcWxTZXJ2ZXI6IG15U1FMU2VydmVyQ29uc3RydWN0Lm15c3FsU2VydmVyLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB2aXJ0dWFsTmV0d29ya0NvbnN0cnVjdCA9IG5ldyBWaXJ0dWFsTmV0d29ya0NvbnN0cnVjdCh0aGlzLCBcIlZpcnR1YWwgTmV0d29ya1wiLCB7XG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwLFxuICAgICAgICB9KTtcblxuXG5cbiAgICAgICAgY29uc3QgY29udGFpbmVyUmVnaXN0cnlTQ29uc3RydWN0ID0gbmV3IENvbnRhaW5lclJlZ2lzdHJ5U0NvbnN0cnVjdCh0aGlzLCBcImNvbnRhaW5lciByZWdpc3RyeVwiLCB7XG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwLFxuICAgICAgICAgICAgYXp1cmVhZENvbnN0cnVjdDogYXp1cmVBZENvbnN0cnVjdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgYXBwbGljYXRpb25JbnNpZ2h0c0NvbnN0cnVjdCA9IG5ldyBBcHBsaWNhdGlvbkluc2lnaHRzQ29uc3RydWN0KHRoaXMsIFwiQXBwbGljYXRpb24gaW5zaWdodHNcIiwge1xuICAgICAgICAgICAgcmVzb3VyY2VHcm91cCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgY29nbml0aXZlU2VydmljZUNvbnN0cnVjdCA9IG5ldyBDb2duaXRpdmVTZXJ2aWNlQ29uc3RydWN0KHRoaXMsIFwiQ29nbml0aXZlIFNlcnZpY2VcIiwge1xuICAgICAgICAgICAgcmVzb3VyY2VHcm91cFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBjaGF0Qm90Q29uc3RydWN0ID0gbmV3IENoYXRCb3RDb25zdHJ1Y3QodGhpcywgXCJDaGF0IEJvdFwiLCB7XG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGtleVZhdWx0Q29uc3RydWN0ID0gbmV3IEtleVZhdWx0Q29uc3RydWN0KHRoaXMsIFwiS2V5VmF1bHRcIiwge1xuICAgICAgICAgICAgcmVzb3VyY2VHcm91cCxcbiAgICAgICAgICAgIHN0b3JhZ2VBY2NvdW50OiBibG9iU3RvcmFnZUNvbnN0cnVjdC5zdG9yYWdlQWNjb3VudCxcbiAgICAgICAgICAgIHNlcnZpY2VQcmluY2lwYWxPYmplY3RJZDogYXp1cmVBZENvbnN0cnVjdC5zZXJ2aWNlUHJpbmNpcGFsT2JqZWN0SWQsXG4gICAgICAgICAgICBhcHBsaWNhdGlvbkluc2lnaHRzS2V5OiBhcHBsaWNhdGlvbkluc2lnaHRzQ29uc3RydWN0LmFwcGxpY2F0aW9uSW5zaWdodHMuaW5zdHJ1bWVudGF0aW9uS2V5LFxuICAgICAgICAgICAgd2ViQ2hhdEJvdFNlY3JldDogY2hhdEJvdENvbnN0cnVjdC53ZWJDaGF0Qm90U2VjcmV0LFxuICAgICAgICAgICAgY29nbml0aXZlU2VydmljZUNvbnN0cnVjdFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBrdWJlcm5ldGVzQ2x1c3RlclNDb25zdHJ1Y3QgPSBuZXcgS3ViZXJuZXRlc0NsdXN0ZXJTQ29uc3RydWN0KHRoaXMsIFwiS3ViZXJuZXRlc1wiLCB7XG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwLFxuICAgICAgICAgICAgdmlydHVhbE5ldHdvcms6IHZpcnR1YWxOZXR3b3JrQ29uc3RydWN0LFxuICAgICAgICAgICAgYXp1cmVBZENvbnN0cnVjdDogYXp1cmVBZENvbnN0cnVjdCxcbiAgICAgICAgICAgIGNvbnRhaW5lclJlZ2lzdHJ5OiBjb250YWluZXJSZWdpc3RyeVNDb25zdHJ1Y3QsXG4gICAgICAgICAgICBrZXlWYXVsdENvbnN0cnVjdDoga2V5VmF1bHRDb25zdHJ1Y3QsXG4gICAgICAgICAgICBteXNxbFNlcnZlckNvbnN0cnVjdDogbXlTUUxTZXJ2ZXJDb25zdHJ1Y3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGdldF9rOHNfZXhwb3NlZF9pcCA9IG5ldyBSZXNvdXJjZSh0aGlzLCBcImdldCBrdWJlY3RsIGV4cG9zZWQgaXBcIiwge1xuICAgICAgICAgICAgdHJpZ2dlcnM6IHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXBlbmRzT246IFtrdWJlcm5ldGVzQ2x1c3RlclNDb25zdHJ1Y3Qua3ViZWN0bF0sXG4gICAgICAgIH0pO1xuICAgICAgICBnZXRfazhzX2V4cG9zZWRfaXAuYWRkT3ZlcnJpZGUoXCJwcm92aXNpb25lci5sb2NhbC1leGVjLmNvbW1hbmRcIixcbiAgICAgICAgICAgIGBzbGVlcCAzMCAmJiBrdWJlY3RsIGdldCBzZXJ2aWNlIC1sIGFwcD13ZWIgLW8ganNvbiB8IGpxIC1yIC5pdGVtc1tdLnN0YXR1cy5sb2FkQmFsYW5jZXIuaW5ncmVzc1tdLmlwID4gazhzZXhwb3NlZGlwLnR4dGBcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBrOHNpcCA9IG5ldyBEYXRhTG9jYWxGaWxlKHRoaXMsIFwiaGFzaF9jb250ZW50XCIsIHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiBcIms4c2V4cG9zZWRpcC50eHRcIixcbiAgICAgICAgICAgIGRlcGVuZHNPbjogW2dldF9rOHNfZXhwb3NlZF9pcF0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGs4c2lwY29udGVudCA9IGs4c2lwLmNvbnRlbnRcblxuICAgICAgICBuZXcgVGVycmFmb3JtT3V0cHV0KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiU2VydmljZSBQcmluY2lwYWwgQXBwIElkXCIsXG4gICAgICAgICAgICB7dmFsdWU6IGF6dXJlQWRDb25zdHJ1Y3Quc2VydmljZVByaW5jaXBhbEFwcElkLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIlNlcnZpY2UgUHJpbmNpcGFsIFBhc3N3b3JkXCIsXG4gICAgICAgICAgICB7dmFsdWU6IGF6dXJlQWRDb25zdHJ1Y3Quc2VydmljZVByaW5jaXBhbFBhc3N3b3JkLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG4gICAgICAgIG5ldyBUZXJyYWZvcm1PdXRwdXQoXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgXCJTZXJ2aWNlIFByaW5jaXBhbCBUZW5hbnQgSWRcIixcbiAgICAgICAgICAgIHt2YWx1ZTogYXp1cmVBZENvbnN0cnVjdC5zZXJ2aWNlUHJpbmNpcGFsVGVuYW50SWQsIHNlbnNpdGl2ZTogdHJ1ZX1cbiAgICAgICAgKTtcblxuICAgICAgICBuZXcgVGVycmFmb3JtT3V0cHV0KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiQ29udGFpbmVyIFJlZ2lzdHJ5IEFkbWluIFVzZXJuYW1lXCIsXG4gICAgICAgICAgICB7dmFsdWU6IGNvbnRhaW5lclJlZ2lzdHJ5U0NvbnN0cnVjdC5jb250YWluZXJSZWdpc3RyeS5hZG1pblVzZXJuYW1lLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIkNvbnRhaW5lciBSZWdpc3RyeSBBZG1pbiBQYXNzd29yZFwiLFxuICAgICAgICAgICAge3ZhbHVlOiBjb250YWluZXJSZWdpc3RyeVNDb25zdHJ1Y3QuY29udGFpbmVyUmVnaXN0cnkuYWRtaW5QYXNzd29yZCwgc2Vuc2l0aXZlOiB0cnVlfVxuICAgICAgICApO1xuXG4gICAgICAgIG5ldyBUZXJyYWZvcm1PdXRwdXQoXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgXCJDb250YWluZXIgUmVnaXN0cnkgSWRlbnRpdHlcIixcbiAgICAgICAgICAgIHt2YWx1ZTogY29udGFpbmVyUmVnaXN0cnlTQ29uc3RydWN0LmNvbnRhaW5lclJlZ2lzdHJ5LmlkZW50aXR5LCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIktleSBWYXVsdCBVcmlcIixcbiAgICAgICAgICAgIHt2YWx1ZToga2V5VmF1bHRDb25zdHJ1Y3Qua2V5VmF1bHQudmF1bHRVcmksIHNlbnNpdGl2ZTogdHJ1ZX1cbiAgICAgICAgKTtcblxuICAgICAgICBuZXcgVGVycmFmb3JtT3V0cHV0KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiSzhzIExvYWRCYWxhbmNlciBJUFwiLFxuICAgICAgICAgICAge3ZhbHVlOiBrOHNpcGNvbnRlbnQsIHNlbnNpdGl2ZTogdHJ1ZX1cbiAgICAgICAgKTtcblxuICAgICAgICBuZXcgVGVycmFmb3JtT3V0cHV0KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiTXlTUUwgU2VydmVyIEhvc3RuYW1lXCIsXG4gICAgICAgICAgICB7dmFsdWU6IG15U1FMU2VydmVyQ29uc3RydWN0Lm15c3FsU2VydmVyLmZxZG4sIHNlbnNpdGl2ZTogdHJ1ZX1cbiAgICAgICAgKTtcbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIk15U1FMIFNlcnZlciBJZGVudGl0eVwiLFxuICAgICAgICAgICAge3ZhbHVlOiBteVNRTFNlcnZlckNvbnN0cnVjdC5teXNxbFNlcnZlci5pZGVudGl0eSwgc2Vuc2l0aXZlOiB0cnVlfVxuICAgICAgICApO1xuXG4gICAgICAgIG5ldyBUZXJyYWZvcm1PdXRwdXQoXG4gICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgXCJNeVNRTCBTZXJ2ZXIgVXNlcm5hbWVcIixcbiAgICAgICAgICAgIHt2YWx1ZTogbXlTUUxTZXJ2ZXJDb25zdHJ1Y3QubXlzcWxTZXJ2ZXIuYWRtaW5pc3RyYXRvckxvZ2luLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcIk15U1FMIFNlcnZlciBQYXNzd29yZFwiLFxuICAgICAgICAgICAge3ZhbHVlOiBteVNRTFNlcnZlckNvbnN0cnVjdC5teXNxbFNlcnZlci5hZG1pbmlzdHJhdG9yTG9naW5QYXNzd29yZCwgc2Vuc2l0aXZlOiB0cnVlfVxuICAgICAgICApO1xuICAgICAgICBjb25zdCBnZXRfaW1hZ2VfdmFyID0gbmV3IFJlc291cmNlKHRoaXMsIFwiZ2V0IGRvY2tlciBpbWFnZSBuYW1lXCIsIHtcbiAgICAgICAgICAgIHRyaWdnZXJzOiB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVwZW5kc09uOiBba3ViZXJuZXRlc0NsdXN0ZXJTQ29uc3RydWN0Lmt1YmVybmV0ZXNDbHVzdGVyXSxcbiAgICAgICAgfSk7XG4gICAgICAgIGdldF9pbWFnZV92YXIuYWRkT3ZlcnJpZGUoXCJwcm92aXNpb25lci5sb2NhbC1leGVjLmNvbW1hbmRcIixcbiAgICAgICAgICAgIGBlY2hvIC1uICQoZ2l0IHN5bWJvbGljLXJlZiAtLXNob3J0IEhFQUQpID4gYnJhbmNoLnR4dCAmJiBlY2hvIC1uICQoZ2l0IHJldi1wYXJzZSAtLXNob3J0IEhFQUQpID4gaGFzaC50eHRgXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgaGFzaF9jb250ZW50ID0gbmV3IERhdGFMb2NhbEZpbGUodGhpcywgXCJoYXNoX2NvbnRlbnRfbWFpblwiLCB7XG4gICAgICAgICAgICBmaWxlbmFtZTogXCJoYXNoLnR4dFwiLFxuICAgICAgICAgICAgZGVwZW5kc09uOiBbZ2V0X2ltYWdlX3Zhcl0sXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBicmFuY2hfY29udGVudCA9IG5ldyBEYXRhTG9jYWxGaWxlKHRoaXMsIFwiYnJhbmNoX2NvbnRlbnRfbWFpblwiLCB7XG4gICAgICAgICAgICBmaWxlbmFtZTogXCJicmFuY2gudHh0XCIsXG4gICAgICAgICAgICBkZXBlbmRzT246IFtnZXRfaW1hZ2VfdmFyXSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGRvY2tlcmltYWdlbmFtZSA9IGNvbnRhaW5lclJlZ2lzdHJ5U0NvbnN0cnVjdC5jb250YWluZXJSZWdpc3RyeS5sb2dpblNlcnZlciArIFwiL1wiICsgcHJvY2Vzcy5lbnYuUFJPSkVDVF9OQU1FISArIFwiLVwiICsgYnJhbmNoX2NvbnRlbnQuY29udGVudCArIFwiOlwiICsgIGhhc2hfY29udGVudC5jb250ZW50IDtcblxuICAgICAgICBuZXcgVGVycmFmb3JtT3V0cHV0KFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIFwiRG9ja2VyIEltYWdlIE5hbWVcIixcbiAgICAgICAgICAgIHt2YWx1ZTogZG9ja2VyaW1hZ2VuYW1lLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcInJlc291cmNlIGdyb3VwIG5hbWVcIixcbiAgICAgICAgICAgIHt2YWx1ZTogcmVzb3VyY2VHcm91cC5uYW1lLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cbiAgICAgICAgbmV3IFRlcnJhZm9ybU91dHB1dChcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBcImt1YmVybmV0ZXMgY2x1c3RlciBuYW1lXCIsXG4gICAgICAgICAgICB7dmFsdWU6IGt1YmVybmV0ZXNDbHVzdGVyU0NvbnN0cnVjdC5rdWJlcm5ldGVzQ2x1c3Rlci5uYW1lLCBzZW5zaXRpdmU6IHRydWV9XG4gICAgICAgICk7XG5cblxuICAgIH1cbn1cblxuY29uc3QgYXBwID0gbmV3IEFwcCgpO1xubmV3IE1haW5TdGFjayhhcHAsIFwiSVRQNDEyMS1Qcm9qZWN0XCIsIHtlbnY6IFwiZGV2XCJ9KTtcbmFwcC5zeW50aCgpO1xuIl19